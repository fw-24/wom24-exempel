<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitor Pastebin</title>

</head>

<!-- Works with ws-node in this repo -->
    
<body>
    <h3>WebSocket Pastebin</h3>
    <input id="in" type="text" placeholder="Paste here">
    <p id="out">...</p>
    <p id="conn-status">Not connected</p>
    <p id="err" style="color: red;"></p>
    <details>
        <summary>Settings</summary>
        <input id="token" placeholder="Access token"><br>
        <input id="ws-url" placeholder="Websocket server"><br>
        <button id="btn-save" type="button">Save</button>
    
    </details>

    <script>
        WS_TOKEN = localStorage.getItem('pastebin-token') || 'my-secret-token';
        PASTEBIN_URL = localStorage.getItem('pastebin-url');

        // Create a WebSocket connection
        const socket = new WebSocket(`${PASTEBIN_URL}?token=${WS_TOKEN}`);

        // Connection established 
        socket.onopen = function (event) {
            console.log('Connected to WebSocket server');
            document.querySelector('#conn-status').innerHTML = "Connected to WebSocket server";
        };

        // Message listener
        socket.onmessage = function (event) {
            console.log('Received message:', event.data);
            const data = JSON.parse(event.data);

            if (data.status == 0) {
                document.querySelector('#out').innerHTML = data.msg;
                document.querySelector('#err').innerHTML = '';
            } else {
                document.querySelector('#err').innerHTML = data.msg;
            }
            
        };

        // Connection closed 
        socket.onclose = function (event) {
            console.log('Connection closed');
            document.querySelector('#conn-status').innerHTML = "Connection closed <button type='button'>Reconnect</button>";

        };

        document.querySelector('#in').addEventListener('input', (evt) => {
            socket.send(evt.target.value);
        });

        document.querySelector('#btn-save').addEventListener('click', () => {
            localStorage.setItem('pastebin-url', document.querySelector('#ws-url').value);
            localStorage.setItem('pastebin-token', document.querySelector('#token').value)
            console.log("TOKEN:", localStorage.getItem('pastebin-token'))
        
        });


    </script>

</body>

</html>
